"use strict";
// temporarily replace package name of package.json to allow for npm install
// this is needed since the package.name may include template variable syntax which
// makes npm install fail due to invalid characters
var fs = require('fs');
exports.temporaryTransformPackage = function (pkgPath /* string */, transform /* (pkgDef: object) => object */) {
    var originalContents = fs.readFileSync(pkgPath, 'utf-8');
    var pkgDef = JSON.parse(originalContents);
    fs.writeFileSync(pkgPath, JSON.stringify(transform(pkgDef)));
    var restored = false;
    var restore = function () {
        if (restored) {
            return;
        }
        restored = true;
        process.off('exit', restore);
        fs.writeFileSync(pkgPath, originalContents);
    };
    process.on('exit', restore);
    return restore;
};
